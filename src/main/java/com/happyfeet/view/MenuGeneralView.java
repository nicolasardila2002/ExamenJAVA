package com.happyfeet.view;

import com.happyfeet.util.LoggerUtil;
import java.util.Scanner;

public class MenuGeneralView {
    private final Scanner input;
    private final MenuPrincipalView menuAdministrativo;
    private final MenuPrincipalView2 menuInventario;

    public MenuGeneralView() {
        this.input = new Scanner(System.in);
        this.menuAdministrativo = new MenuPrincipalView();
        this.menuInventario = new MenuPrincipalView2();
    }

    public void mostrarMenu() {
        mostrarBienvenidaGeneral();

        String opcion = "";
        boolean continuar = true;
        while (continuar) {
            mostrarMenuSeleccion();

            // Intentar leer la entrada con un manejo m√°s robusto
            if (input.hasNextLine()) {
                opcion = input.nextLine().trim();
                try {
                    procesarOpcion(opcion);
                } catch (Exception e) {
                    LoggerUtil.error("Error al procesar la opci√≥n del men√∫: " + e.getMessage());
                    System.out.println("‚ùå Error inesperado al procesar la opci√≥n. Intente nuevamente.");
                    pausar();
                }
                if (opcion.equals("0")) {
                    continuar = false; // Fuerza la salida del bucle al seleccionar "0"
                }
            } else {
                LoggerUtil.error("No hay entrada disponible para leer la opci√≥n");
                System.out.println("‚ùå Error: No se pudo leer la entrada. ¬øDesea reiniciar o salir? (R/S)");
                if (input.hasNextLine()) {
                    String respuesta = input.nextLine().trim().toUpperCase();
                    if ("S".equals(respuesta)) {
                        continuar = false; // Sale del programa
                    } else if ("R".equals(respuesta)) {
                        opcion = ""; // Reinicia el bucle
                    } else {
                        System.out.println("‚ùå Opci√≥n no v√°lida. Cerrando programa.");
                        continuar = false;
                    }
                } else {
                    System.out.println("‚ùå No se pudo leer respuesta. Cerrando programa.");
                    continuar = false;
                }
            }
        }

        mostrarDespedidaGeneral();
        if (input != null && input.ioException() == null) {
            input.close();
        }
    }

    private void mostrarBienvenidaGeneral() {
        limpiarPantalla();
        System.out.println("\n\n");
        System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                         üêæ HAPPY FEET VETERINARIA üêæ                          ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                    SISTEMA INTEGRAL DE GESTI√ìN VETERINARIA                    ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                           Versi√≥n 1.0 - 2025                                  ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        System.out.println("\n              üåü Cuidando la salud de tus mascotas con amor üåü\n");
        LoggerUtil.info("Sistema Happy Feet iniciado correctamente");
    }

    private void mostrarMenuSeleccion() {
        System.out.println("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        System.out.println("‚ïë                        SELECCI√ìN DE M√ìDULO DEL SISTEMA                          ‚ïë");
        System.out.println("‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  ‚ï£");
        System.out.println("‚ïë                                                                                 ‚ïë");
        System.out.println("‚ïë   Por favor, seleccione el m√≥dulo al que desea acceder:                         ‚ïë");
        System.out.println("‚ïë                                                                                 ‚ïë");
        System.out.println("‚ïë   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚ïë");
        System.out.println("‚ïë   ‚îÇ                                                                     ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ  1. üë®‚Äç‚öïÔ∏è  M√ìDULO ADMINISTRATIVO                                       ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ                                                                     ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Gesti√≥n de Pacientes (Due√±os y Mascotas)                      ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Gesti√≥n de Veterinarios                                       ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Gesti√≥n de Citas M√©dicas                                      ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Historial Cl√≠nico                                             ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Reportes y Estad√≠sticas                                       ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ                                                                     ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚ïë");
        System.out.println("‚ïë                                                                                 ‚ïë");
        System.out.println("‚ïë   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚ïë");
        System.out.println("‚ïë   ‚îÇ                                                                     ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ  2. üè™ M√ìDULO DE INVENTARIO Y FACTURACI√ìN                           ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ                                                                     ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Gesti√≥n de Inventario                                         ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Gesti√≥n de Facturas                                           ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Items de Factura                                              ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Tipos de Producto                                             ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ     ‚Ä¢ Control de Stock                                              ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îÇ                                                                     ‚îÇ       ‚ïë");
        System.out.println("‚ïë   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚ïë");
        System.out.println("‚ïë                                                                                 ‚ïë");
        System.out.println("‚ïë   0. üö™ Salir del Sistema                                                       ‚ïë");
        System.out.println("‚ïë                                                                                 ‚ïë");
        System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê==‚ïù");
        System.out.print("\n>>> Seleccione un m√≥dulo [1-2, 0]: ");
    }

    private void procesarOpcion(String opcion) {
        switch (opcion) {
            case "1":
                LoggerUtil.info("Accediendo al M√≥dulo Administrativo");
                System.out.println("\n‚úì Cargando M√≥dulo Administrativo...\n");
                pausar();
                menuAdministrativo.mostrarMenu();
                break;
            case "2":
                LoggerUtil.info("Accediendo al M√≥dulo de Inventario y Facturaci√≥n");
                System.out.println("\n‚úì Cargando M√≥dulo de Inventario y Facturaci√≥n...\n");
                pausar();
                menuInventario.mostrarMenu();
                break;
            case "0":
                LoggerUtil.info("Usuario solicit√≥ salir del sistema");
                break;
            default:
                System.out.println("\n‚ùå Opci√≥n inv√°lida. Por favor seleccione 1, 2 o 0.");
                pausar();
                break;
        }
    }

    private void mostrarDespedidaGeneral() {
        limpiarPantalla();
        System.out.println("\n\n");
        System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                      ¬°Gracias por usar Happy Feet Veterinaria!                ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                    Cuidando la salud de nuestras mascotas                     ‚ïë");
        System.out.println("‚ïë                         con amor y profesionalismo                            ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                            ¬°Hasta pronto! üêæ                                  ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïë                          Sistema cerrado exitosamente                         ‚ïë");
        System.out.println("‚ïë                                                                               ‚ïë");
        System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        System.out.println("\n");
        LoggerUtil.info("Sistema Happy Feet cerrado correctamente");
    }

    private void limpiarPantalla() {
        try {
            if (System.getProperty("os.name").contains("Windows")) {
                new ProcessBuilder("cmd", "/c", "cls").inheritIO().start().waitFor();
            } else {
                System.out.print("\033[H\033[2J");
                System.out.flush();
            }
        } catch (Exception e) {
            // Si falla la limpieza, simplemente continuamos
            for (int i = 0; i < 50; i++) {
                System.out.println();
            }
        }
    }

    private void pausar() {
        System.out.print("\nPresione ENTER para continuar...");
        try {
            if (input.hasNextLine()) {
                input.nextLine(); // Lee la entrada solo si est√° disponible
            } else {
                LoggerUtil.info("No hay l√≠nea disponible para pausar. Continuando autom√°ticamente.");
                System.out.println(); // Salto de l√≠nea para mantener formato
            }
        } catch (Exception e) {
            LoggerUtil.error("Error al pausar: " + e.getMessage());
            System.out.println(); // Salto de l√≠nea como fallback
        }
    }
}